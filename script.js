const bsadMapping={2078:[14,15,15,16,17,17,18,17,16,15,13,15],2079:[14,15,15,17,17,17,18,17,16,15,13,15],2080:[14,15,16,17,18,18,18,17,17,15,13,14],2081:[13,14,15,16,17,17,17,16,16,14,13,14],2082:[14,15,15,17,17,17,18,17,16,15,13,15],2083:[14,15,15,17,17,17,18,17,16,15,13,15],2084:[14,15,15,17,17,17,17,16,16,14,13,14],2085:[13,14,15,16,17,16,17,16,16,14,13,15],2086:[14,14,15,16,17,17,17,16,16,14,13,15],2087:[14,15,15,17,17,17,18,17,17,16,15,17]},bsMonthNames=["Baisakh","Jestha","Ashadh","Shrawan","Bhadra","Ashwin","Kartik","Mangsir","Poush","Magh","Falgun","Chaitra"];function setDefaultDates(){let e=new Date;document.getElementById("ad-date").valueAsDate=e;let t=adToBS(e);t&&(document.getElementById("bs-year").value=t.bs_year,document.getElementById("bs-month").value=t.bs_month,document.getElementById("bs-day").value=t.bs_day)}function updateTodayInfo(){let e=new Date,t=e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),a=adToBS(e),n=`Today: ${t}`;a&&(n+=` / BS ${a.bs_day} ${bsMonthNames[a.bs_month-1]} ${a.bs_year}`),document.getElementById("today-info").innerText=n}function getADDateFromBSData(e,t,a){if(!bsadMapping[e]||t<1||t>12)return null;let n=e-57,_=bsadMapping[e][t-1],l=(t+2)%12,s=new Date(l>=3?n:n+1,l,_);return s.setDate(s.getDate()+a-1),s}function getDaysInBSMonth(e,t){if(!bsadMapping[t]||e<1||e>12)return null;let a=e%12+1,n=e<12?t:t+1;if(bsadMapping[n]&&bsadMapping[n][a-1]){let _=getADDateFromBSData(t,e,1),l=getADDateFromBSData(n,a,1);if(_&&l)return Math.floor((l-_)/864e5)}return 30}function bsToAD(e,t,a){return getADDateFromBSData(e,t,a)}function adToBS(e){for(let t in bsadMapping)for(let a=1;a<=12;a++){let n=getADDateFromBSData(t,a,1),_=a%12+1,l=a<12?parseInt(t):parseInt(t)+1,s;if(bsadMapping[l]&&bsadMapping[l][_-1]?(s=getADDateFromBSData(l,_,1)).setDate(s.getDate()-1):(s=new Date(n)).setDate(s.getDate()+29),e>=n&&e<=s){let d=e-n,r=Math.floor(d/864e5)+1;return{bs_day:r,bs_month:a,bs_year:parseInt(t)}}}return null}function getADDateRangeForBSMonth(e,t){if(!bsadMapping[e]||t<1||t>12)return{start:null,end:null};let a=getADDateFromBSData(e,t,1),n=t%12+1,_=t<12?e:e+1,l;return bsadMapping[_]&&bsadMapping[_][n-1]?(l=getADDateFromBSData(_,n,1)).setDate(l.getDate()-1):(l=new Date(a)).setDate(l.getDate()+29),{start:a,end:l}}function convertBStoAD(){let e=parseInt(document.getElementById("bs-year").value),t=parseInt(document.getElementById("bs-month").value),a=parseInt(document.getElementById("bs-day").value),n=getDaysInBSMonth(t,e);if(a<1||a>n){document.getElementById("bs-to-ad-result").innerText=`Invalid day. ${bsMonthNames[t-1]} ${e} has ${n} days.`,document.getElementById("bs-to-ad-result").style.display="block";return}let _=bsToAD(e,t,a);if(_){let l=_.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",weekday:"long"});document.getElementById("bs-to-ad-result").innerText=`BS ${a} ${bsMonthNames[t-1]} ${e} = ${l}`,document.getElementById("bs-to-ad-result").style.display="block"}else document.getElementById("bs-to-ad-result").innerText="Conversion failed. Please check your input.",document.getElementById("bs-to-ad-result").style.display="block"}function convertADtoBS(){let e=document.getElementById("ad-date").value;if(!e){document.getElementById("ad-to-bs-result").innerText="Please select a date.",document.getElementById("ad-to-bs-result").style.display="block";return}let t=new Date(e),a=adToBS(t);if(a){let n=`BS ${a.bs_day} ${bsMonthNames[a.bs_month-1]} ${a.bs_year}`;document.getElementById("ad-to-bs-result").innerText=`${t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",weekday:"long"})} = ${n}`,document.getElementById("ad-to-bs-result").style.display="block"}else document.getElementById("ad-to-bs-result").innerText="Conversion failed. Date may be out of supported range.",document.getElementById("ad-to-bs-result").style.display="block"}function renderBSCalendar(){let e=new Date,t=adToBS(e);if(!t)return;let a=t.bs_year,n=t.bs_month;document.getElementById("calendar-title").innerText=`BS Calendar - ${bsMonthNames[n-1]} ${a}`;let _=getADDateRangeForBSMonth(a,n);if(!_.start||!_.end)return;let l=_.start,s=getDaysInBSMonth(n,a),d=l.getDay(),r="",o=1;for(let i=0;i<6&&!(o>s);i++){r+="<tr>";for(let y=0;y<7;y++)if(0===i&&y<d||o>s)r+='<td class="other-month"></td>';else{let g=o===t.bs_day,u=g?"current-day":"",b=bsToAD(a,n,o),m=b?b.getDate()+"/"+(b.getMonth()+1):"";r+=`<td class="${u}">
                    <div>${o}</div>
                    <div style="font-size: 0.8em; color: #666;">${m}</div>
                </td>`,o++}r+="</tr>"}document.getElementById("calendar-body").innerHTML=r}function updateCalendar(e,t){document.getElementById("calendar-title").innerText=`BS Calendar - ${bsMonthNames[t-1]} ${e}`;let a=getADDateRangeForBSMonth(e,t);if(!a.start||!a.end)return;let n=a.start,_=getDaysInBSMonth(t,e),l=n.getDay(),s="",d=1,r=new Date,o=adToBS(r),i=o&&o.bs_month===t&&o.bs_year===e;for(let y=0;y<6&&!(d>_);y++){s+="<tr>";for(let g=0;g<7;g++)if(0===y&&g<l||d>_)s+='<td class="other-month"></td>';else{let u=i&&d===o.bs_day,b=u?"current-day":"",m=bsToAD(e,t,d),D=m?m.getDate()+"/"+(m.getMonth()+1):"";s+=`<td class="${b}">
                    <div>${d}</div>
                    <div style="font-size: 0.8em; color: #666;">${D}</div>
                </td>`,d++}s+="</tr>"}document.getElementById("calendar-body").innerHTML=s}window.onload=function(){setDefaultDates(),updateTodayInfo(),renderBSCalendar()},document.getElementById("bs-month").addEventListener("change",function(){let e=parseInt(document.getElementById("bs-year").value),t=parseInt(this.value);updateCalendar(e,t)}),document.getElementById("bs-year").addEventListener("change",function(){let e=parseInt(this.value),t=parseInt(document.getElementById("bs-month").value);updateCalendar(e,t)});